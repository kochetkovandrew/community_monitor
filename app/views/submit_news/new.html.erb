<!DOCTYPE html>
<html>
<head>
  <script src='https://code.jquery.com/jquery-1.7.1.js'></script>
  <script src="https://vk.com/js/api/xd_connection.js?2" type="text/javascript"></script>
  <script>
    VK.init(function() {
        <% if @group_id == 133980650 %>
        $('#uploadbtn').change(function(e){
            $.each(e.target.files, function (index, file) {
                span = $('<span class="filespan"></span>');
                span.text(file.name);
                $('div#filenames').append(span);
            });
        });
        <% end %>
        $('button#submit_news').click(function() {
        $.ajax({
          type: 'POST',
          url: 'https://detivich.org/submit_news.json',
          data: {
            api_id: $('#api_id').val(),
            viewer_id: $('#viewer_id').val(),
            group_id: $('#group_id').val(),
            auth_key: $('#auth_key').val(),
            message: $('#message').val()
          },
          success: function(data) {
              $('#message').val('');
              span = $("<span style='width: 570px; background-color: greenyellow'>Ваша новость была отправлена</span>")
              $('div#notification').append(span);
          }
        });
      });
    });
  </script>
  <style type="text/css">
    .filespan {
      background: #eee;
      padding: 2px;
      border: 1px solid #333;
      color: #333;
      text-align: center;
      border-radius: 2px;
      cursor: pointer;
      font-size: 12px;
      font-family: sans-serif;
      margin: 2px;
    }
    div#filenames {
      margin: 2px;
    }
    .uploadButton {
      background: #eee;
      padding: 2px;
      border: 1px solid #333;
      color: #333;
      text-align: center;
      border-radius: 2px;
      cursor: pointer;
      font-size: 12px;
      font-family: sans-serif;
    }
    .uploadButton:hover {
      background: #ddd;
    }
    #submit_news {
      background: #eee;
      padding: 2px;
      border: 1px solid #333;
      color: #333;
      text-align: center;
      border-radius: 2px;
      cursor: pointer;
      font-size: 12px;
      font-family: sans-serif;
    }
  </style>
</head>
<body style='text-align:center;'>
<%= hidden_field_tag('api_id', @api_id) %>
<%= hidden_field_tag('viewer_id', @viewer_id) %>
<%= hidden_field_tag('group_id', @group_id) %>
<%= hidden_field_tag('auth_key', @auth_key) %>
<div id="notification" style="width: 570px;"></div>
<textarea style='height: 430px; width: 570px;' id="message"></textarea>
<br>
<div align="center">
  <% if @group_id == 133980650 %>

    <label for="uploadbtn" class="uploadButton">Загрузить файл</label>
    <input style="opacity: 0; z-index: -1;" type="file" name="upload" id="uploadbtn" multiple>
  <% end %>
  <button type="button" id="submit_news">Предложить новость</button>
  <% if @group_id == 133980650 %>
    <br>
    <div id="filenames"></div>
  <% end %>
</div>
</body>
</html>