<p id="notice"><%= notice %></p>

<h4>Список отслеживаемых сообществ</h4>

<table id="listing_communities">
  <thead>
    <tr>
      <th></th>
      <th>Название</th>
      <th>Короткое имя</th>
      <th>VK ID</th>
      <th>Участников</th>
      <th>Прирост</th>
      <th>&nbsp;</th>
    </tr>
  </thead>

  <tbody>
    <% @communities.each do |community| %>
      <tr>
        <td width="8px;">
          <% if community.monitor_members %>
              <i class="fa fa-cherry fa-star fa-2x"></i>
          <% end %>
        </td>
        <td>
          <%= community.name %>
        </td>
        <td><%= link_to community.screen_name, 'https://vk.com/' + community.screen_name %></td>
        <td><%= community.vk_id %></td>
        <td>
          <% if !@histories_hash[community.id].nil? %>
            <%= @histories_hash[community.id].members_count %>
          <% end %>
        </td>
        <td>
          <% if !@histories_hash[community.id].nil? %>
            <% if !@histories_hash[community.id].diff.nil? %>
              <% diff = JSON::parse(@histories_hash[community.id].diff) %>
              <%= diff['added'].count - diff['removed'].count %>
            <% end %>
          <% end %>
        </td>
        <td><%= link_to content_tag(:i, '', class: 'fa fa-info fa-lg fa-fw'), community, { class: 'btn btn-sm btn-outline-primary', role: 'button', title: 'Показать'} %>
          <%= link_to content_tag(:i, '', class: 'fa fa-edit fa-lg fa-fw'), edit_community_path(community), { class: 'btn btn-sm btn-outline-primary', role: 'button', title: 'Редактировать'} %>
          <!--
          <%= link_to 'Destroy', community, method: :delete, data: { confirm: 'Are you sure?' } %>--></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Community', new_community_path %>
